# routes/pdf_service.py
from flask import Blueprint, request, send_file, jsonify
from fpdf import FPDF
import io

pdf_bp = Blueprint("pdf", __name__)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ§¾ Utility Function â€” Generate PDF
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def generate_pdf_report(title, subtitle, summary):
    pdf = FPDF()
    pdf.add_page()
    pdf.set_font("Helvetica", "B", 16)
    pdf.cell(0, 10, title, ln=True, align="C")

    pdf.set_font("Helvetica", "", 12)
    pdf.cell(0, 10, subtitle, ln=True, align="C")
    pdf.ln(10)

    pdf.multi_cell(0, 10, summary)
    pdf.ln(10)
    pdf.set_font("Helvetica", "I", 10)
    pdf.cell(0, 10, "Generated by SE Textile AI Dashboard", ln=True, align="C")

    pdf_output = io.BytesIO()
    pdf.output(pdf_output)
    pdf_output.seek(0)
    return pdf_output


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ“¤ API Endpoint â€” Generate AI Report as PDF
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@pdf_bp.route("/generate", methods=["POST"])
def generate_pdf():
    """
    Expects JSON payload:
    {
      "title": "Report Title",
      "subtitle": "AI Summary",
      "summary": "Generated summary text"
    }
    """
    try:
        data = request.get_json() or {}
        title = data.get("title", "SE Textile Report")
        subtitle = data.get("subtitle", "AI Analytics Summary")
        summary = data.get("summary", "No summary content provided.")

        pdf_output = generate_pdf_report(title, subtitle, summary)

        return send_file(
            pdf_output,
            mimetype="application/pdf",
            as_attachment=True,
            download_name="report.pdf"
        )

    except Exception as e:
        print("[Error - PDF Generation]", e)
        return jsonify({"status": "error", "message": str(e)}), 500
